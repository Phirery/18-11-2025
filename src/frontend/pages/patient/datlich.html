<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Đặt Lịch Khám</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px 0;
        }

        .booking-wrapper {
            max-width: 1100px;
            margin: 30px auto;
        }

        .booking-card {
            background: #fff;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .booking-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            text-align: center;
            color: white;
        }

        .booking-header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .booking-header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .booking-body {
            padding: 40px;
        }

        /* Step Indicator */
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            position: relative;
        }

        .step-indicator::before {
            content: "";
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 3px;
            background: #e0e0e0;
            z-index: 0;
        }

        .step-indicator .progress-line {
            position: absolute;
            top: 20px;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            z-index: 1;
        }

        .step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .step-circle {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: #e0e0e0;
            color: #999;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .step.active .step-circle,
        .step.completed .step-circle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .step-label {
            font-size: 0.85rem;
            color: #999;
            font-weight: 500;
        }

        .step.active .step-label,
        .step.completed .step-label {
            color: #667eea;
            font-weight: 600;
        }

        .section {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 3px solid #667eea;
            display: inline-block;
        }

        /* Selection Cards */
        .selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .selection-card {
            border: 2px solid #e0e0e0;
            border-radius: 16px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: #fafafa;
            position: relative;
        }

        .selection-card:hover {
            border-color: #667eea;
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);
        }

        .selection-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .selection-card .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-bottom: 16px;
        }

        .selection-card .card-title {
            font-weight: 700;
            font-size: 1.1rem;
            color: #333;
            margin-bottom: 8px;
        }

        .selection-card .card-subtitle {
            font-size: 0.9rem;
            color: #666;
        }

        .selection-card .check-icon {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .selection-card.selected .check-icon {
            display: flex;
        }

        /* Doctor Cards */
        .doctor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .doctor-card {
            border: 2px solid #e0e0e0;
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .doctor-card:hover {
            border-color: #667eea;
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);
        }

        .doctor-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .doctor-card .doctor-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .doctor-card .doctor-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 12px;
        }

        .doctor-card .doctor-name {
            font-weight: 700;
            font-size: 1rem;
            color: #333;
        }

        .doctor-card .doctor-specialty {
            font-size: 0.85rem;
            color: #666;
        }

        .doctor-card .expert-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
            color: #333;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 8px;
        }

        /* Time Slots */
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .time-slot {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            font-weight: 600;
            color: #333;
        }

        .time-slot:hover:not(.disabled) {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .time-slot.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .time-slot.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: #f5f5f5;
        }

        .time-slot i {
            display: block;
            margin-bottom: 6px;
            font-size: 1.2rem;
        }

        /* Package Type Cards */
        .package-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .package-type-card {
            border: 2px solid #e0e0e0;
            border-radius: 16px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: white;
            position: relative;
        }

        .package-type-card:hover:not(.disabled) {
            border-color: #667eea;
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);
        }

        .package-type-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .package-type-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .package-type-card .package-name {
            font-weight: 700;
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 12px;
        }

        .package-type-card .package-price {
            font-size: 1.8rem;
            color: #667eea;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .package-type-card .package-description {
            font-size: 0.9rem;
            color: #666;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            gap: 16px;
        }

        .btn-custom {
            padding: 14px 32px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-prev {
            background: #e0e0e0;
            color: #666;
        }

        .btn-prev:hover {
            background: #d0d0d0;
        }

        .btn-next,
        .btn-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-next:hover,
        .btn-submit:hover {
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
            transform: translateY(-2px);
        }

        .btn-next:disabled,
        .btn-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Summary Card */
        .summary-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            font-weight: 600;
            color: #666;
        }

        .summary-value {
            font-weight: 700;
            color: #333;
        }

        .form-control {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 12px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .shift-selector {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .shift-btn {
            flex: 1;
            padding: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-align: center;
        }

        .shift-btn:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .shift-btn.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        @media (max-width: 768px) {
            .booking-header h1 {
                font-size: 1.5rem;
            }

            .booking-body {
                padding: 24px;
            }

            .step-label {
                font-size: 0.75rem;
            }

            .selection-grid,
            .doctor-grid {
                grid-template-columns: 1fr;
            }

            .time-slots {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }
    </style>
</head>

<body>
    <div class="booking-wrapper">
        <div class="booking-card">
            <div class="booking-header">
                <h1><i class="fas fa-calendar-check"></i> Đặt Lịch Khám</h1>
                <p>Hoàn thành các bước đơn giản để đặt lịch khám</p>
            </div>

            <div class="booking-body">
                <!-- Step Indicator -->
                <div class="step-indicator">
                    <div class="progress-line" id="progressLine"></div>
                    <div class="step active" data-step="1">
                        <div class="step-circle">1</div>
                        <div class="step-label">Khoa</div>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-circle">2</div>
                        <div class="step-label">Chuyên Khoa</div>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-circle">3</div>
                        <div class="step-label">Ngày & Bác Sĩ</div>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-circle">4</div>
                        <div class="step-label">Giờ Khám</div>
                    </div>
                    <div class="step" data-step="5">
                        <div class="step-circle">5</div>
                        <div class="step-label">Xác Nhận</div>
                    </div>
                </div>

                <!-- Step 1: Chọn Khoa -->
                <div class="section active" id="step1">
                    <h2 class="section-title">Chọn Khoa Khám</h2>
                    <div class="selection-grid" id="departmentGrid"></div>
                    <div class="nav-buttons">
                        <button class="btn-custom btn-prev" style="visibility: hidden">
                            <i class="fas fa-arrow-left"></i> Quay Lại
                        </button>
                        <button class="btn-custom btn-next" id="btnStep1Next" disabled>
                            Tiếp Theo <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Chọn Chuyên Khoa -->
                <div class="section" id="step2">
                    <h2 class="section-title">Chọn Chuyên Khoa</h2>
                    <div class="selection-grid" id="specialtyGrid"></div>
                    <div class="nav-buttons">
                        <button class="btn-custom btn-prev" onclick="goToStep(1)">
                            <i class="fas fa-arrow-left"></i> Quay Lại
                        </button>
                        <button class="btn-custom btn-next" id="btnStep2Next" disabled>
                            Tiếp Theo <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Chọn Ngày & Bác Sĩ -->
                <div class="section" id="step3">
                    <h2 class="section-title">Chọn Ngày Khám</h2>
                    <div class="mb-4">
                        <input type="date" class="form-control" id="appointmentDate" />
                    </div>

                    <h2 class="section-title">Chọn Bác Sĩ</h2>
                    <div class="doctor-grid" id="doctorGrid"></div>

                    <div class="nav-buttons">
                        <button class="btn-custom btn-prev" onclick="goToStep(2)">
                            <i class="fas fa-arrow-left"></i> Quay Lại
                        </button>
                        <button class="btn-custom btn-next" id="btnStep3Next" disabled>
                            Tiếp Theo <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 4: Chọn Ca & Giờ Khám -->
                <div class="section" id="step4">
                    <h2 class="section-title">Chọn Ca Làm Việc</h2>
                    <div class="shift-selector" id="shiftSelector"></div>

                    <h2 class="section-title">Chọn Suất Khám</h2>
                    <div class="time-slots" id="timeSlots"></div>

                    <h2 class="section-title">Chọn Gói Khám</h2>
                    <div class="package-type-grid" id="packageTypeGrid"></div>

                    <div class="nav-buttons">
                        <button class="btn-custom btn-prev" onclick="goToStep(3)">
                            <i class="fas fa-arrow-left"></i> Quay Lại
                        </button>
                        <button class="btn-custom btn-next" id="btnStep4Next" disabled>
                            Tiếp Theo <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 5: Xác Nhận -->
                <div class="section" id="step5">
                    <h2 class="section-title">Xác Nhận Thông Tin</h2>
                    <div class="summary-card" id="summaryCard"></div>

                    <div class="mb-4">
                        <label class="form-label">Ghi chú (không bắt buộc)</label>
                        <textarea class="form-control" rows="4" id="notes"
                            placeholder="Nhập ghi chú hoặc yêu cầu đặc biệt..."></textarea>
                    </div>

                    <div class="nav-buttons">
                        <button class="btn-custom btn-prev" onclick="goToStep(4)">
                            <i class="fas fa-arrow-left"></i> Quay Lại
                        </button>
                        <button class="btn-custom btn-submit" onclick="submitBooking()">
                            <i class="fas fa-check-circle"></i> Xác Nhận Đặt Lịch
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // MOCK DATA - Dữ liệu giả đầy đủ để test luồng
        const MOCK_DATA = {
            departments: [
                { id: 1, name: "Nội Khoa", icon: "fa-heartbeat" },
                { id: 2, name: "Ngoại Khoa", icon: "fa-hand-holding-medical" },
                { id: 3, name: "Sản Phụ Khoa", icon: "fa-baby" },
                { id: 4, name: "Nhi Khoa", icon: "fa-child" },
                { id: 5, name: "Mắt", icon: "fa-eye" },
                { id: 6, name: "Tai Mũi Họng", icon: "fa-head-side-mask" }
            ],
            specialties: {
                1: [
                    { id: 11, name: "Tim Mạch", icon: "fa-heartbeat" },
                    { id: 12, name: "Tiêu Hóa", icon: "fa-stomach" },
                    { id: 13, name: "Hô Hấp", icon: "fa-lungs" },
                    { id: 14, name: "Thần Kinh", icon: "fa-brain" },
                    { id: 15, name: "Nội Tiết", icon: "fa-syringe" }
                ],
                2: [
                    { id: 21, name: "Chấn Thương Chỉnh Hình", icon: "fa-bone" },
                    { id: 22, name: "Tiết Niệu", icon: "fa-kidneys" },
                    { id: 23, name: "Ngoại Tổng Quát", icon: "fa-procedures" }
                ],
                3: [
                    { id: 31, name: "Sản Khoa", icon: "fa-baby-carriage" },
                    { id: 32, name: "Phụ Khoa", icon: "fa-female" }
                ],
                4: [
                    { id: 41, name: "Nhi Tổng Quát", icon: "fa-child" },
                    { id: 42, name: "Nhi Tiêu Hóa", icon: "fa-baby" }
                ],
                5: [
                    { id: 51, name: "Khúc Xạ", icon: "fa-glasses" },
                    { id: 52, name: "Võng Mạc", icon: "fa-eye" }
                ],
                6: [
                    { id: 61, name: "Tai", icon: "fa-deaf" },
                    { id: 62, name: "Mũi Họng", icon: "fa-head-side-mask" }
                ]
            },
            doctors: [
                // Tim Mạch
                {
                    id: 1,
                    name: "PGS.TS.BS Nguyễn Văn Hùng",
                    specialty_id: 11,
                    is_expert: true,
                    work_days: ["2025-11-15", "2025-11-16", "2025-11-18", "2025-11-19", "2025-11-20"],
                    shifts: {
                        morning: { start: "07:00", end: "11:00", slot_duration: 40 },
                        afternoon: { start: "13:00", end: "17:00", slot_duration: 40 }
                    },
                    booked_slots: ["2025-11-15T07:00", "2025-11-15T09:20", "2025-11-15T13:00"]
                },
                {
                    id: 2,
                    name: "BS. Trần Thị Mai Anh",
                    specialty_id: 11,
                    is_expert: false,
                    work_days: ["2025-11-15", "2025-11-16", "2025-11-17", "2025-11-18"],
                    shifts: {
                        morning: { start: "08:00", end: "12:00", slot_duration: 40 },
                        afternoon: { start: "14:00", end: "18:00", slot_duration: 40 }
                    },
                    booked_slots: ["2025-11-15T08:00", "2025-11-15T14:00"]
                },
                {
                    id: 3,
                    name: "ThS.BS Lê Minh Tuấn",
                    specialty_id: 11,
                    is_expert: true,
                    work_days: ["2025-11-16", "2025-11-17", "2025-11-19", "2025-11-20"],
                    shifts: {
                        morning: { start: "07:30", end: "11:30", slot_duration: 40 }
                    },
                    booked_slots: []
                },
                
                // Tiêu Hóa
                {
                    id: 4,
                    name: "BS.CKII Phạm Văn Đức",
                    specialty_id: 12,
                    is_expert: true,
                    work_days: ["2025-11-15", "2025-11-17", "2025-11-19"],
                    shifts: {
                        morning: { start: "07:00", end: "11:00", slot_duration: 40 },
                        afternoon: { start: "13:30", end: "17:30", slot_duration: 40 }
                    },
                    booked_slots: ["2025-11-15T07:40", "2025-11-15T10:20"]
                },
                {
                    id: 5,
                    name: "BS. Hoàng Thị Lan",
                    specialty_id: 12,
                    is_expert: false,
                    work_days: ["2025-11-15", "2025-11-16", "2025-11-17", "2025-11-18", "2025-11-19"],
                    shifts: {
                        afternoon: { start: "13:00", end: "17:00", slot_duration: 40 }
                    },
                    booked_slots: ["2025-11-15T13:40"]
                },

                // Hô Hấp
                {
                    id: 6,
                    name: "PGS.BS Đỗ Quang Minh",
                    specialty_id: 13,
                    is_expert: true,
                    work_days: ["2025-11-15", "2025-11-16", "2025-11-18"],
                    shifts: {
                        morning: { start: "08:00", end: "12:00", slot_duration: 40 },
                        afternoon: { start: "14:00", end: "17:00", slot_duration: 40 }
                    },
                    booked_slots: ["2025-11-15T08:00", "2025-11-15T08:40", "2025-11-15T14:00"]
                },

                // Chấn Thương Chỉnh Hình
                {
                    id: 7,
                    name: "TS.BS Ngô Văn Thành",
                    specialty_id: 21,
                    is_expert: true,
                    work_days: ["2025-11-15", "2025-11-17", "2025-11-19"],
                    shifts: {
                        morning: { start: "07:00", end: "11:00", slot_duration: 40 },
                        afternoon: { start: "13:00", end: "16:00", slot_duration: 40 }
                    },
                    booked_slots: []
                },
                {
                    id: 8,
                    name: "BS. Vũ Thị Hương",
                    specialty_id: 21,
                    is_expert: false,
                    work_days: ["2025-11-15", "2025-11-16", "2025-11-17", "2025-11-18", "2025-11-19"],
                    shifts: {
                        morning: { start: "08:00", end: "12:00", slot_duration: 40 }
                    },
                    booked_slots: ["2025-11-15T09:20", "2025-11-15T10:00"]
                },

                // Sản Khoa
                {
                    id: 9,
                    name: "BS.CKII Trần Thị Bích Ngọc",
                    specialty_id: 31,
                    is_expert: true,
                    work_days: ["2025-11-15", "2025-11-16", "2025-11-17", "2025-11-18"],
                    shifts: {
                        morning: { start: "07:00", end: "11:00", slot_duration: 40 },
                        afternoon: { start: "13:00", end: "17:00", slot_duration: 40 }
                    },
                    booked_slots: ["2025-11-15T07:00", "2025-11-15T13:00", "2025-11-15T13:40"]
                },
                {
                    id: 10,
                    name: "BS. Lê Thị Thanh Hà",
                    specialty_id: 31,
                    is_expert: false,
                    work_days: ["2025-11-15", "2025-11-16", "2025-11-19"],
                    shifts: {
                        afternoon: { start: "14:00", end: "18:00", slot_duration: 40 }
                    },
                    booked_slots: []
                },

                // Nhi Tổng Quát
                {
                    id: 11,
                    name: "ThS.BS Phạm Minh Đức",
                    specialty_id: 41,
                    is_expert: true,
                    work_days: ["2025-11-15", "2025-11-16", "2025-11-17", "2025-11-18", "2025-11-19"],
                    shifts: {
                        morning: { start: "07:30", end: "11:30", slot_duration: 40 },
                        afternoon: { start: "13:30", end: "17:30", slot_duration: 40 }
                    },
                    booked_slots: ["2025-11-15T07:30", "2025-11-15T09:50"]
                },
                {
                    id: 12,
                    name: "BS. Nguyễn Thị Thu",
                    specialty_id: 41,
                    is_expert: false,
                    work_days: ["2025-11-15", "2025-11-17", "2025-11-19"],
                    shifts: {
                        morning: { start: "08:00", end: "12:00", slot_duration: 40 }
                    },
                    booked_slots: ["2025-11-15T08:40"]
                },

                // Mắt
                {
                    id: 13,
                    name: "BS.CKII Đặng Văn Long",
                    specialty_id: 51,
                    is_expert: true,
                    work_days: ["2025-11-15", "2025-11-16", "2025-11-18", "2025-11-19"],
                    shifts: {
                        morning: { start: "07:00", end: "11:00", slot_duration: 40 },
                        afternoon: { start: "13:00", end: "16:00", slot_duration: 40 }
                    },
                    booked_slots: ["2025-11-15T10:20"]
                },

                // Tai Mũi Họng
                {
                    id: 14,
                    name: "BS. Võ Thị Kim Anh",
                    specialty_id: 61,
                    is_expert: false,
                    work_days: ["2025-11-15", "2025-11-16", "2025-11-17", "2025-11-18", "2025-11-19"],
                    shifts: {
                        morning: { start: "08:00", end: "12:00", slot_duration: 40 },
                        afternoon: { start: "14:00", end: "18:00", slot_duration: 40 }
                    },
                    booked_slots: ["2025-11-15T08:00", "2025-11-15T14:00", "2025-11-15T15:20"]
                }
            ],
            packageTypes: [
                { id: "normal", name: "Khám Bình Thường", price: "150.000đ", description: "Dịch vụ khám bệnh tiêu chuẩn với bác sĩ đa khoa" },
                { id: "expert", name: "Khám Chuyên Gia", price: "250.000đ", description: "Khám với bác sĩ chuyên gia giàu kinh nghiệm, trình độ cao", requireExpert: true }
            ]
        };

        // STATE
        const bookingState = {
            department: null,
            specialty: null,
            date: null,
            doctor: null,
            shift: null,
            time: null,
            packageType: null
        };

        // HELPER FUNCTIONS
        function formatDate(dateStr) {
            const d = new Date(dateStr);
            return `${d.getDate().toString().padStart(2, '0')}/${(d.getMonth() + 1).toString().padStart(2, '0')}/${d.getFullYear()}`;
        }

        function generateTimeSlots(start, end, duration) {
            const slots = [];
            let current = new Date(`2000-01-01T${start}`);
            const endTime = new Date(`2000-01-01T${end}`);

            while (current < endTime) {
                const slotEnd = new Date(current.getTime() + duration * 60000);
                slots.push({
                    start: current.toTimeString().slice(0, 5),
                    end: slotEnd.toTimeString().slice(0, 5)
                });
                current = slotEnd;
            }
            return slots;
        }

        function goToStep(stepNumber) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(sec => sec.classList.remove('active'));
            document.getElementById('step' + stepNumber).classList.add('active');

            const steps = document.querySelectorAll('.step');
            steps.forEach(s => {
                s.classList.remove('active', 'completed');
                const step = parseInt(s.dataset.step);
                if (step < stepNumber) s.classList.add('completed');
                if (step === stepNumber) s.classList.add('active');
            });

            const progressLine = document.getElementById('progressLine');
            const percent = ((stepNumber - 1) / (steps.length - 1)) * 100;
            progressLine.style.width = percent + '%';
        }

        // RENDER FUNCTIONS
        function renderDepartments() {
            const container = document.getElementById('departmentGrid');
            let html = '';

            MOCK_DATA.departments.forEach(dept => {
                html += `
                    <div class="selection-card" data-id="${dept.id}" onclick="selectDepartment(${dept.id})">
                        <div class="card-icon"><i class="fas ${dept.icon}"></i></div>
                        <div class="card-title">${dept.name}</div>
                        <div class="check-icon"><i class="fas fa-check"></i></div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function renderSpecialties(departmentId) {
            const container = document.getElementById('specialtyGrid');
            const specialties = MOCK_DATA.specialties[departmentId] || [];
            let html = '';

            specialties.forEach(spec => {
                html += `
                    <div class="selection-card" data-id="${spec.id}" onclick="selectSpecialty(${spec.id})">
                        <div class="card-icon"><i class="fas ${spec.icon}"></i></div>
                        <div class="card-title">${spec.name}</div>
                        <div class="check-icon"><i class="fas fa-check"></i></div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function renderDoctors(specialtyId, date) {
            const container = document.getElementById('doctorGrid');
            // Filter doctors by specialty and available on selected date
            const availableDoctors = MOCK_DATA.doctors.filter(doc => 
                doc.specialty_id === specialtyId && 
                doc.work_days.includes(date)
            );

            if (availableDoctors.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-user-md"></i><p>Không có bác sĩ khả dụng trong ngày này</p></div>';
                return;
            }

            let html = '';
            availableDoctors.forEach(doctor => {
                html += `
                    <div class="doctor-card" data-id="${doctor.id}" onclick="selectDoctor(${doctor.id})">
                        <div class="doctor-header">
                            <div class="doctor-avatar"><i class="fas fa-user-md"></i></div>
                            <div>
                                <div class="doctor-name">${doctor.name}</div>
                                <div class="doctor-specialty">Chuyên khoa: ${getSpecialtyName(doctor.specialty_id)}</div>
                            </div>
                        </div>
                        ${doctor.is_expert ? '<div class="expert-badge"><i class="fas fa-star"></i> Bác Sĩ Chuyên Gia</div>' : ''}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function renderShifts(doctorId) {
            const container = document.getElementById('shiftSelector');
            const doctor = MOCK_DATA.doctors.find(d => d.id === doctorId);
            
            let html = '';
            if (doctor.shifts.morning) {
                html += `
                    <div class="shift-btn" data-shift="morning" onclick="selectShift('morning')">
                        <i class="fas fa-sun"></i> Ca Sáng<br>
                        <small>${doctor.shifts.morning.start} - ${doctor.shifts.morning.end}</small>
                    </div>
                `;
            }
            if (doctor.shifts.afternoon) {
                html += `
                    <div class="shift-btn" data-shift="afternoon" onclick="selectShift('afternoon')">
                        <i class="fas fa-cloud-sun"></i> Ca Chiều<br>
                        <small>${doctor.shifts.afternoon.start} - ${doctor.shifts.afternoon.end}</small>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        function renderTimeSlots(doctorId, shift) {
            const container = document.getElementById('timeSlots');
            const doctor = MOCK_DATA.doctors.find(d => d.id === doctorId);
            const shiftData = doctor.shifts[shift];
            
            const slots = generateTimeSlots(shiftData.start, shiftData.end, shiftData.slot_duration);
            let html = '';

            slots.forEach(slot => {
                const slotDateTime = `${bookingState.date}T${slot.start}`;
                const isBooked = doctor.booked_slots.includes(slotDateTime);
                const disabledClass = isBooked ? 'disabled' : '';
                const onclick = isBooked ? '' : `onclick="selectTime('${slot.start}')"`;

                html += `
                    <div class="time-slot ${disabledClass}" data-time="${slot.start}" ${onclick}>
                        <i class="fas fa-clock"></i>
                        <div>${slot.start} - ${slot.end}</div>
                        ${isBooked ? '<small style="color: #ff4d4f;">Đã đặt</small>' : ''}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function renderPackageTypes(doctorId) {
            const container = document.getElementById('packageTypeGrid');
            const doctor = MOCK_DATA.doctors.find(d => d.id === doctorId);
            
            let html = '';
            MOCK_DATA.packageTypes.forEach(pkg => {
                const disabled = pkg.requireExpert && !doctor.is_expert;
                const disabledClass = disabled ? 'disabled' : '';
                const onclick = disabled ? '' : `onclick="selectPackageType('${pkg.id}')"`;

                html += `
                    <div class="package-type-card ${disabledClass}" data-id="${pkg.id}" ${onclick}>
                        <div class="package-name">${pkg.name}</div>
                        <div class="package-price">${pkg.price}</div>
                        <div class="package-description">${pkg.description}</div>
                        ${disabled ? '<small style="color: #ff4d4f; margin-top: 10px; display: block;">Không khả dụng</small>' : ''}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function renderSummary() {
            const container = document.getElementById('summaryCard');
            
            const department = MOCK_DATA.departments.find(d => d.id === bookingState.department);
            const specialty = MOCK_DATA.specialties[bookingState.department].find(s => s.id === bookingState.specialty);
            const doctor = MOCK_DATA.doctors.find(d => d.id === bookingState.doctor);
            const packageType = MOCK_DATA.packageTypes.find(p => p.id === bookingState.packageType);

            container.innerHTML = `
                <div class="summary-item">
                    <div class="summary-label">Khoa:</div>
                    <div class="summary-value">${department.name}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Chuyên Khoa:</div>
                    <div class="summary-value">${specialty.name}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Bác Sĩ:</div>
                    <div class="summary-value">${doctor.name} ${doctor.is_expert ? '(Chuyên Gia)' : ''}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Ngày Khám:</div>
                    <div class="summary-value">${formatDate(bookingState.date)}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Ca Làm Việc:</div>
                    <div class="summary-value">${bookingState.shift === 'morning' ? 'Ca Sáng' : 'Ca Chiều'}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Giờ Khám:</div>
                    <div class="summary-value">${bookingState.time}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Gói Khám:</div>
                    <div class="summary-value">${packageType.name} - ${packageType.price}</div>
                </div>
            `;
        }

        // SELECTION HANDLERS
function selectDepartment(id) {
    bookingState.department = id;
    bookingState.specialty = null;
    bookingState.doctor = null;
    bookingState.date = null;
    bookingState.shift = null;
    bookingState.time = null;
    bookingState.packageType = null;

    // Highlight selected
    document.querySelectorAll('#departmentGrid .selection-card').forEach(card => {
        card.classList.toggle('selected', parseInt(card.dataset.id) === id);
    });

    renderSpecialties(id);
    document.getElementById('btnStep1Next').disabled = false;
}

function selectSpecialty(id) {
    bookingState.specialty = id;
    bookingState.doctor = null;
    bookingState.date = null;
    bookingState.shift = null;
    bookingState.time = null;
    bookingState.packageType = null;

    document.querySelectorAll('#specialtyGrid .selection-card').forEach(card => {
        card.classList.toggle('selected', parseInt(card.dataset.id) === id);
    });

    document.getElementById('btnStep2Next').disabled = false;
}

function selectDate(date) {
    bookingState.date = date;
    bookingState.doctor = null;
    bookingState.shift = null;
    bookingState.time = null;
    bookingState.packageType = null;
    document.getElementById('btnStep3Next').disabled = true;
}

function selectDoctor(id) {
    bookingState.doctor = id;
    bookingState.shift = null;
    bookingState.time = null;
    bookingState.packageType = null;

    document.querySelectorAll('#doctorGrid .doctor-card').forEach(card => {
        card.classList.toggle('selected', parseInt(card.dataset.id) === id);
    });

    renderShifts(id);
    document.getElementById('btnStep3Next').disabled = false;
}

function selectShift(shift) {
    bookingState.shift = shift;
    bookingState.time = null;
    bookingState.packageType = null;

    document.querySelectorAll('#shiftSelector .shift-btn').forEach(btn => {
        btn.classList.toggle('selected', btn.dataset.shift === shift);
    });

    renderTimeSlots(bookingState.doctor, shift);
    renderPackageTypes(bookingState.doctor);
    document.getElementById('btnStep4Next').disabled = true;
}

function selectTime(time) {
    bookingState.time = time;
    document.querySelectorAll('#timeSlots .time-slot').forEach(slot => {
        slot.classList.toggle('selected', slot.dataset.time === time);
    });
    document.getElementById('btnStep4Next').disabled = !bookingState.time || !bookingState.packageType;
}

function selectPackageType(id) {
    bookingState.packageType = id;
    document.querySelectorAll('#packageTypeGrid .package-type-card').forEach(card => {
        card.classList.toggle('selected', card.dataset.id === id);
    });
    document.getElementById('btnStep4Next').disabled = !bookingState.time || !bookingState.packageType;
}

// BUTTON EVENTS
document.getElementById('btnStep1Next').addEventListener('click', () => goToStep(2));
document.getElementById('btnStep2Next').addEventListener('click', () => goToStep(3));
document.getElementById('btnStep3Next').addEventListener('click', () => goToStep(4));
document.getElementById('btnStep4Next').addEventListener('click', () => {
    renderSummary();
    goToStep(5);
});

function getSpecialtyName(id) {
    for (const deptId in MOCK_DATA.specialties) {
        const spec = MOCK_DATA.specialties[deptId].find(s => s.id === id);
        if (spec) return spec.name;
    }
    return '';
}

function submitBooking() {
    const notes = document.getElementById('notes').value;
    console.log('Booking Submitted:', { ...bookingState, notes });
    alert('Đặt lịch thành công!');
}

// Initialize
renderDepartments();

// Update date input listener
document.getElementById('appointmentDate').addEventListener('change', (e) => {
    const date = e.target.value;
    bookingState.date = date;
    if (bookingState.specialty && date) {
        renderDoctors(bookingState.specialty, date);
        document.getElementById('btnStep3Next').disabled = true;
    }
});
// SELECTION HANDLERS
function selectDepartment(id) {
    bookingState.department = id;
    bookingState.specialty = null;
    bookingState.doctor = null;
    bookingState.date = null;
    bookingState.shift = null;
    bookingState.time = null;
    bookingState.packageType = null;

    // Highlight selected
    document.querySelectorAll('#departmentGrid .selection-card').forEach(card => {
        card.classList.toggle('selected', parseInt(card.dataset.id) === id);
    });

    renderSpecialties(id);
    document.getElementById('btnStep1Next').disabled = false;
}

function selectSpecialty(id) {
    bookingState.specialty = id;
    bookingState.doctor = null;
    bookingState.date = null;
    bookingState.shift = null;
    bookingState.time = null;
    bookingState.packageType = null;

    document.querySelectorAll('#specialtyGrid .selection-card').forEach(card => {
        card.classList.toggle('selected', parseInt(card.dataset.id) === id);
    });

    document.getElementById('btnStep2Next').disabled = false;
}

function selectDate(date) {
    bookingState.date = date;
    bookingState.doctor = null;
    bookingState.shift = null;
    bookingState.time = null;
    bookingState.packageType = null;
    document.getElementById('btnStep3Next').disabled = true;
}

function selectDoctor(id) {
    bookingState.doctor = id;
    bookingState.shift = null;
    bookingState.time = null;
    bookingState.packageType = null;

    document.querySelectorAll('#doctorGrid .doctor-card').forEach(card => {
        card.classList.toggle('selected', parseInt(card.dataset.id) === id);
    });

    renderShifts(id);
    document.getElementById('btnStep3Next').disabled = false;
}

function selectShift(shift) {
    bookingState.shift = shift;
    bookingState.time = null;
    bookingState.packageType = null;

    document.querySelectorAll('#shiftSelector .shift-btn').forEach(btn => {
        btn.classList.toggle('selected', btn.dataset.shift === shift);
    });

    renderTimeSlots(bookingState.doctor, shift);
    renderPackageTypes(bookingState.doctor);
    document.getElementById('btnStep4Next').disabled = true;
}

function selectTime(time) {
    bookingState.time = time;
    document.querySelectorAll('#timeSlots .time-slot').forEach(slot => {
        slot.classList.toggle('selected', slot.dataset.time === time);
    });
    document.getElementById('btnStep4Next').disabled = !bookingState.time || !bookingState.packageType;
}

function selectPackageType(id) {
    bookingState.packageType = id;
    document.querySelectorAll('#packageTypeGrid .package-type-card').forEach(card => {
        card.classList.toggle('selected', card.dataset.id === id);
    });
    document.getElementById('btnStep4Next').disabled = !bookingState.time || !bookingState.packageType;
}

// BUTTON EVENTS
document.getElementById('btnStep1Next').addEventListener('click', () => goToStep(2));
document.getElementById('btnStep2Next').addEventListener('click', () => goToStep(3));
document.getElementById('btnStep3Next').addEventListener('click', () => goToStep(4));
document.getElementById('btnStep4Next').addEventListener('click', () => {
    renderSummary();
    goToStep(5);
});

function getSpecialtyName(id) {
    for (const deptId in MOCK_DATA.specialties) {
        const spec = MOCK_DATA.specialties[deptId].find(s => s.id === id);
        if (spec) return spec.name;
    }
    return '';
}

function submitBooking() {
    const notes = document.getElementById('notes').value;
    console.log('Booking Submitted:', { ...bookingState, notes });
    alert('Đặt lịch thành công!');
}

// Initialize
renderDepartments();

// Update date input listener
document.getElementById('appointmentDate').addEventListener('change', (e) => {
    const date = e.target.value;
    bookingState.date = date;
    if (bookingState.specialty && date) {
        renderDoctors(bookingState.specialty, date);
        document.getElementById('btnStep3Next').disabled = true;
    }
});

    </script>
</body>
</html>